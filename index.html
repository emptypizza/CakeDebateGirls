
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cake Debate - Critical Update</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Nanum+Gothic:wght@400;700;800&family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nanum Gothic', sans-serif;
            background-color: #333;
            overflow: hidden;
            user-select: none;
        }
        
        body.ja-font {
            font-family: 'M PLUS Rounded 1c', sans-serif;
        }

        /* Î∞∞Í≤Ω Î∞è Î†àÏù¥ÏïÑÏõÉ */
        .game-scene {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            background-size: cover;
            background-position: center;
            overflow: hidden;
            transition: background-image 0.5s ease;
        }

        .overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.1);
            pointer-events: none;
        }

        .table-surface {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 35%;
            background: linear-gradient(to bottom, rgba(139, 69, 19, 0.8), rgba(101, 67, 33, 1));
            border-top: 5px solid rgba(255,255,255,0.2);
            transform-origin: bottom;
            transform: perspective(1000px) rotateX(20deg) scale(1.2);
            z-index: 1;
        }

        /* Ï∫êÎ¶≠ÌÑ∞ Ïª®ÌÖåÏù¥ÎÑà */
        .character-container {
            position: absolute;
            bottom: 15%;
            width: 35vh;
            height: 60vh;
            z-index: 2;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        .character-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: bottom;
            transform: scaleX(-1);
        }

        #pc1-container { left: 5%; }
        #pc2-container { right: 5%; }

        /* ÏºÄÏù¥ÌÅ¨ */
        .cake-track {
            position: absolute;
            bottom: 25%;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 10px;
            z-index: 3;
            border-radius: 50%;
        }

        .cake-obj {
            position: absolute;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            width: 18vh;
            height: auto;
            transition: left 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.4));
            z-index: 4;
        }

        /* ÎßêÌíçÏÑ† */
        .bubble-area {
            position: absolute;
            bottom: 90%;
            left: 50%;
            width: 300px;
            z-index: 50;
            opacity: 0;
            transform: translateX(-50%) scale(0.8);
            transform-origin: bottom center;
            transition: opacity 0.3s ease, transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
            display: flex;
            justify-content: center;
        }

        .bubble-area.active {
            opacity: 1 !important;
            transform: translateX(-50%) scale(1);
        }

        .bubble {
            background: white;
            padding: 1.2rem;
            border-radius: 20px;
            border: 3px solid #000;
            font-family: 'Jua', 'M PLUS Rounded 1c', sans-serif;
            font-size: 1.2rem;
            line-height: 1.3;
            color: #333;
            box-shadow: 5px 5px 0px rgba(0,0,0,0.2);
            position: relative;
            text-align: center;
            word-break: keep-all;
            background-color: #fff;
        }

        .bubble::after {
            content: '';
            position: absolute;
            bottom: -18px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-width: 18px 12px 0;
            border-style: solid;
            border-color: #000 transparent transparent transparent;
        }
        .bubble::before {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-width: 18px 12px 0;
            border-style: solid;
            border-color: #fff transparent transparent transparent;
            z-index: 1;
        }

        /* UI Ìå®ÎÑê */
        .ui-panel {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 25%;
            background: linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0));
            z-index: 20;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding-bottom: 2rem;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 5%;
            margin-bottom: 1rem;
        }

        .hp-container {
            width: 300px;
            position: relative;
        }

        .hp-label {
            color: white;
            font-family: 'Jua', 'M PLUS Rounded 1c', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 0 #000;
            display: flex;
            justify-content: space-between;
        }

        .hp-frame {
            height: 25px;
            background: #444;
            border: 3px solid white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .hp-bar {
            height: 100%;
            width: 100%;
            transition: width 0.5s ease;
        }
        #p1-hp { background: linear-gradient(90deg, #ff6b6b, #ff4757); }
        #p2-hp { background: linear-gradient(90deg, #5352ed, #3742fa); }

        .controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .btn-card {
            width: 140px;
            height: 100px;
            background: white;
            border: 4px solid #333;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 6px 0 #888;
            font-family: 'Jua', 'M PLUS Rounded 1c', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .btn-card:active {
            transform: translateY(6px);
            box-shadow: 0 0 0 #888;
        }
        
        .btn-card:disabled {
            filter: grayscale(100%);
            opacity: 0.6;
            cursor: not-allowed;
            transform: translateY(6px);
            box-shadow: 0 0 0 #888;
        }

        .btn-icon { font-size: 2rem; margin-bottom: 5px; }
        .btn-text { font-size: 1.2rem; font-weight: bold; }
        .btn-cost { 
            position: absolute; 
            top: 5px; 
            right: 5px; 
            font-size: 0.8rem; 
            color: #e74c3c; 
            font-weight: bold; 
        }

        .turn-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 1rem 3rem;
            border-radius: 50px;
            font-family: 'Jua', 'M PLUS Rounded 1c', sans-serif;
            font-size: 2rem;
            z-index: 50;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            white-space: nowrap;
            border: 2px solid white;
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .shake { animation: shake 0.5s; }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .pop { animation: pop 0.2s; }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: 'Jua', 'M PLUS Rounded 1c', sans-serif;
        }
        .modal h1 { font-size: 4rem; margin-bottom: 2rem; text-shadow: 4px 4px 0 #ff4757; }
        
        .start-btn {
            background: #ff4757;
            color: white;
            padding: 1rem 3rem;
            font-size: 2rem;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 6px 0 #c0392b;
            transition: transform 0.1s;
        }
        .start-btn:active { transform: translateY(6px); box-shadow: none; }
        .hidden { display: none !important; }

        /* Ïñ∏Ïñ¥ ÏÑ†ÌÉù Î≤ÑÌäº */
        .lang-btn-group { display: flex; gap: 20px; }
        .lang-btn {
            background: white;
            color: #333;
            padding: 1rem 2rem;
            font-size: 1.5rem;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #888;
        }
        .lang-btn:hover { background: #eee; }
        .lang-btn:active { transform: translateY(4px); box-shadow: none; }

        .center-line {
            position: absolute;
            left: 50%;
            bottom: 25%;
            height: 100px;
            border-left: 2px dashed rgba(255,255,255,0.5);
            transform: translateX(-50%);
            z-index: 2;
        }

        .damage-text {
            position: absolute;
            color: #ff4757;
            font-weight: bold;
            font-size: 2rem;
            text-shadow: 2px 2px 0 white;
            animation: floatUp 1s forwards;
            pointer-events: none;
            z-index: 50;
            transition: all 0.2s;
        }

        /* ÌÅ¨Î¶¨Ìã∞Ïª¨/ÎÖ∏Î©Ä ÌÖçÏä§Ìä∏ Ïä§ÌÉÄÏùº */
        .dmg-crit { font-size: 3.5rem !important; color: #ff0000 !important; text-shadow: 4px 4px 0 #000 !important; }
        .dmg-weak { font-size: 1.5rem !important; color: #aaa !important; opacity: 0.8; }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-80px) scale(1.1); opacity: 0; }
        }
    </style>
</head>
<body>

    <div id="lang-screen" class="modal">
        <h1 style="font-size: 2.5rem;">Select Language</h1>
        <div class="lang-btn-group">
            <button class="lang-btn" onclick="selectLanguage('ko')">üá∞üá∑ ÌïúÍµ≠Ïñ¥</button>
            <button class="lang-btn" onclick="selectLanguage('ja')">üáØüáµ Êó•Êú¨Ë™û</button>
        </div>
    </div>

    <div id="start-screen" class="modal hidden">
        <h1 id="title-text">Cake Debate</h1>
        <p id="desc-main" class="mb-8 text-xl text-gray-300">...</p>
        <p id="desc-sub" class="mb-8 text-md text-gray-400">...</p>
        <button id="start-btn-text" class="start-btn" onclick="startGame()">Start</button>
    </div>

    <div id="game-over-screen" class="modal hidden">
        <h1 id="result-title">Win!</h1>
        <p id="result-desc" class="mb-8 text-xl">...</p>
        <button id="restart-btn-text" class="start-btn" onclick="location.reload()">Restart</button>
    </div>

    <div id="game-scene" class="game-scene">
        <div class="overlay"></div>
        <div class="table-surface"></div>
        <div class="center-line"></div>

        <div id="pc1-container" class="character-container">
            <div id="pc1-bubble" class="bubble-area">
                <div class="bubble" id="p1-text">...</div>
            </div>
            <img id="img-pc1" src="pc1.png" class="character-img" alt="Player" 
                 onerror="handleImageError(this, 'pc1')">
        </div>

        <div id="pc2-container" class="character-container">
            <div id="pc2-bubble" class="bubble-area">
                <div class="bubble" id="p2-text">...</div>
            </div>
            <img id="img-pc2" src="pc2.png" class="character-img" alt="Rival" 
                 onerror="handleImageError(this, 'pc2')">
        </div>

        <div class="cake-track">
            <div id="cake-obj" class="cake-obj">
                <img id="img-cake" src="cake.png" style="width:100%; border-radius:10px; border:2px solid white; box-shadow:0 4px 8px rgba(0,0,0,0.3);" alt="Cake"
                     onerror="handleImageError(this, 'cake')">
                <div class="absolute -bottom-6 w-full text-center text-white font-bold drop-shadow-md">TARGET</div>
            </div>
        </div>

        <div id="turn-indicator" class="turn-indicator">Turn</div>

        <div class="ui-panel">
            <div class="status-bar">
                <div class="hp-container">
                    <div class="hp-label">
                        <span id="ui-you">YOU</span>
                        <span id="p1-hp-text">100</span>
                    </div>
                    <div class="hp-frame">
                        <div id="p1-hp" class="hp-bar"></div>
                    </div>
                </div>

                <div class="hp-container text-right">
                    <div class="hp-label">
                        <span id="p2-hp-text">100</span>
                        <span id="ui-rival">RIVAL</span>
                    </div>
                    <div class="hp-frame">
                        <div id="p2-hp" class="hp-bar"></div>
                    </div>
                </div>
            </div>

            <div class="controls" id="controls">
                <button class="btn-card" onclick="playerAction('chat')">
                    <div class="btn-cost">HP 2</div>
                    <div class="btn-icon">üí¨</div>
                    <div class="btn-text" id="btn-chat-name">Chat</div>
                    <div class="text-xs text-gray-500 mt-1" id="btn-chat-desc">Pull (++)</div>
                </button>
                <button class="btn-card" onclick="playerAction('flatter')">
                    <div class="btn-cost">HP 0</div>
                    <div class="btn-icon">‚ú®</div>
                    <div class="btn-text" id="btn-flatter-name">Flatter</div>
                    <div class="text-xs text-gray-500 mt-1" id="btn-flatter-desc">Super Pull (UP!)</div>
                </button>
                <button class="btn-card" onclick="playerAction('attack')">
                    <div class="btn-cost">HP 10</div>
                    <div class="btn-icon">üí¢</div>
                    <div class="btn-text" id="btn-attack-name">Attack</div>
                    <div class="text-xs text-gray-500 mt-1" id="btn-attack-desc">Dmg / Pull (+)</div>
                </button>
                <button class="btn-card" onclick="playerAction('cry')">
                    <div class="btn-cost" id="ui-heal">Heal</div>
                    <div class="btn-icon">üíß</div>
                    <div class="btn-text" id="btn-cry-name">Cry</div>
                    <div class="text-xs text-gray-500 mt-1" id="btn-cry-desc">Heal / Wait</div>
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- ÏÇ¨Ïö¥Îìú ÏãúÏä§ÌÖú ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        const sounds = {
            chat: { type: 'sine', freq: [500, 600], duration: 0.1 },
            flatter: { type: 'triangle', freq: [400, 600, 800], duration: 0.15 },
            attack: { type: 'sawtooth', freq: [150, 100], duration: 0.2 },
            cry: { type: 'sine', freq: [400, 300], duration: 0.4 },
            win: { type: 'square', freq: [523, 659, 784, 1046], duration: 0.15 },
            lose: { type: 'sawtooth', freq: [300, 250, 200, 150], duration: 0.3 }
        };

        function playSound(name) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const config = sounds[name];
            if (!config) return;
            let startTime = audioCtx.currentTime;
            config.freq.forEach((f, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = config.type;
                osc.frequency.setValueAtTime(f, startTime + i * 0.1);
                gain.gain.setValueAtTime(0.1, startTime + i * 0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + i * 0.1 + config.duration);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(startTime + i * 0.1);
                osc.stop(startTime + i * 0.1 + config.duration);
            });
        }

        // --- Îã§Íµ≠Ïñ¥ Îç∞Ïù¥ÌÑ∞ (Localization) ---
        const langData = {
            ko: {
                title: "üç∞ Cake Debate üç∞",
                descMain: "ÎßêÎ°ú ÏÉÅÎåÄÎ•º Ï†úÏïïÌïòÍ≥† ÏºÄÏù¥ÌÅ¨Î•º Ï∞®ÏßÄÌïòÏÑ∏Ïöî!",
                descSub: "ÏÇ¨Ïö¥ÎìúÍ∞Ä Ïû¨ÏÉùÎê©ÎãàÎã§. Î≥ºÎ•®ÏùÑ Ï°∞Ï†àÌï¥Ï£ºÏÑ∏Ïöî.",
                startBtn: "ÌÜ†Î°† ÏãúÏûë",
                restartBtn: "Îã§Ïãú ÌïòÍ∏∞",
                ui: {
                    you: "ÎÇò",
                    rival: "ÏÉÅÎåÄÎ∞©",
                    heal: "ÌöåÎ≥µ",
                    btns: {
                        chat: { name: "ÏïÑÎ¨¥Îßê", desc: "ÎãπÍ∏∞Í∏∞ (++)" },
                        flatter: { name: "Ïπ≠Ï∞¨", desc: "ÏäàÌçº ÎãπÍ∏∞Í∏∞ (UP!)" },
                        attack: { name: "ÎπÑÎÇú", desc: "Î©òÌÉàÍ≥µÍ≤© / ÎãπÍ∏∞Í∏∞" },
                        cry: { name: "Ïä¨Ìîî", desc: "ÌöåÎ≥µ / Ï°∞Í∏à Î∞ÄÎ¶º" }
                    }
                },
                turn: {
                    player: "ÎãπÏã†Ïùò ÌÑ¥!",
                    ai: "ÏÉÅÎåÄÎ∞©Ïùò ÌÑ¥..."
                },
                result: {
                    winTitle: "üéâ ÏäπÎ¶¨! üéâ",
                    winDesc: "ÏÉÅÎåÄÏùò Î©òÌÉàÏùÑ Î∂ÄÏàòÍ≥† ÏºÄÏù¥ÌÅ¨Î•º ÏüÅÏ∑®ÌñàÏäµÎãàÎã§!",
                    loseTitle: "üò≠ Ìå®Î∞∞... üò≠",
                    loseDesc: "Î©òÌÉàÏù¥ Î∞îÎã•ÎÇ¨ÏäµÎãàÎã§... ÏºÄÏù¥ÌÅ¨Îäî Ï†Ä Î©ÄÎ¶¨..."
                },
                dialogues: {
                    chat: ["Ïò§Îäò ÎÇ†Ïî®Í∞Ä Ï∞∏ Ï¢ãÏßÄ ÏïäÏïÑ?", "ÎÑà Í∑∏ Î®∏Î¶¨ÌïÄ, Ïñ¥ÎîîÏÑú ÏÉÄÏñ¥?", "ÏºÄÏù¥ÌÅ¨Ïóî Ïó≠Ïãú ÏïÑÎ©îÎ¶¨Ïπ¥ÎÖ∏ÏßÄ.", "Í∑ºÎç∞ ÎÑà ÏàôÏ†úÎäî Îã§ ÌñàÎãà?"],
                    flatter: ["ÎÑå ÏõÉÏùÑ ÎïåÍ∞Ä Ï†úÏùº ÏòàÎªê!", "ÎÑàÏ≤òÎüº ÎòëÎòëÌïú Ïï†Îäî Ï≤òÏùå Î¥ê.", "Ïó≠Ïãú ÎÑå Î∞∞Î†§Ïã¨Ïù¥ ÍπäÍµ¨ÎÇò.", "Ïò§Îäò Ïä§ÌÉÄÏùº ÏôÑÏ†Ñ ÏïÑÏù¥Îèå Í∞ôÏïÑ!"],
                    attack: ["ÎÑà ÏßÑÏßú Ïù¥Í∏∞Ï†ÅÏù¥Îã§.", "ÏñëÏã¨Ïù¥ ÏûàÏúºÎ©¥ Ï¢Ä ÎπÑÏºúÏ§ÑÎûò?", "ÎßêÏù¥ Ïïà ÌÜµÌïòÎÑ§ Ï†ïÎßê.", "ÎÑà ÏπúÍµ¨ ÏóÜÏßÄ?"],
                    cry: ["ÎÇò ÏöîÏ¶ò ÎÑàÎ¨¥ ÌûòÎì§Ïñ¥...", "Ïò§Îäò ÌïòÎ£®Îßå ÏñëÎ≥¥Ìï¥Ï£ºÎ©¥ Ïïà Îèº?", "ÌùëÌùë... Îãπ Îñ®Ïñ¥Ï†∏ÏÑú Í∑∏Îûò...", "ÎÇ¥Í∞Ä Î∂àÏåçÌïòÏßÄÎèÑ ÏïäÏïÑ?"],
                    stun: ["ÏúºÏúº... Î©òÌÉà Î∂ïÍ¥¥...", "ÎßêÎ¨∏Ïù¥ ÎßâÌòîÏñ¥...", "ÎÑàÎ¨¥Ìï¥...", "..."]
                },
                alertNoHp: "Î©òÌÉàÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§! Ìú¥Ïãù(ÏïÑÎ¨¥Îßê/Ïπ≠Ï∞¨)Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§."
            },
            ja: {
                title: "üç∞ „Ç±„Éº„Ç≠‰∫âÂ•™Êà¶ üç∞",
                descMain: "Ë®ÄËëâ„ÅßÁõ∏Êâã„ÇíÂà∂Âúß„Åó„ÄÅ„Ç±„Éº„Ç≠„ÇíÁã¨„ÇäÂç†„ÇÅ„Åó„Çà„ÅÜÔºÅ",
                descSub: "Èü≥Â£∞„ÅåÂÜçÁîü„Åï„Çå„Åæ„Åô„ÄÇÈü≥Èáè„Å´„ÅîÊ≥®ÊÑè„Åè„Å†„Åï„ÅÑ„ÄÇ",
                startBtn: "„Ç≤„Éº„É†ÈñãÂßã",
                restartBtn: "„ÇÇ„ÅÜ‰∏ÄÂ∫¶",
                ui: {
                    you: "Ëá™ÂàÜ",
                    rival: "Áõ∏Êâã",
                    heal: "ÂõûÂæ©",
                    btns: {
                        chat: { name: "ÈõëË´á", desc: "Âºï„ÅçÂØÑ„Åõ (++)" },
                        flatter: { name: "„Åä‰∏ñËæû", desc: "Ë∂ÖÂºï„ÅçÂØÑ„Åõ (UP!)" },
                        attack: { name: "ÈùûÈõ£", desc: "ÊîªÊíÉ / Âºï„ÅçÂØÑ„Åõ" },
                        cry: { name: "Ê≥£„Åè", desc: "ÂõûÂæ© / Â∞ë„ÅóÂæåÈÄÄ" }
                    }
                },
                turn: {
                    player: "„ÅÇ„Å™„Åü„ÅÆ„Çø„Éº„É≥ÔºÅ",
                    ai: "Áõ∏Êâã„ÅÆ„Çø„Éº„É≥..."
                },
                result: {
                    winTitle: "üéâ ÂãùÂà©ÔºÅ üéâ",
                    winDesc: "Áõ∏Êâã„ÅÆ„É°„É≥„Çø„É´„ÇíÂ¥©Â£ä„Åï„Åõ„ÄÅ„Ç±„Éº„Ç≠„ÇíÂãù„Å°Âèñ„Çä„Åæ„Åó„ÅüÔºÅ",
                    loseTitle: "üò≠ ÊïóÂåó... üò≠",
                    loseDesc: "„É°„É≥„Çø„É´„ÅåÂ∞Ω„Åç„Åæ„Åó„Åü... „Ç±„Éº„Ç≠„ÅØÈÅ†„Åè„Å∏..."
                },
                dialogues: {
                    chat: ["‰ªäÊó•„ÅÆÂ§©Ê∞ó„ÄÅÂæÆÂ¶ô„Å†„Å≠„ÄÇ", "„Åù„ÅÆÊúç„ÄÅ„Å©„Åì„ÅßË≤∑„Å£„Åü„ÅÆÔºü", "„Ç±„Éº„Ç≠„Å´„ÅØ„ÇÑ„Å£„Å±„Çä„Ç≥„Éº„Éí„Éº„Å†„Å≠„ÄÇ", "ÂÆøÈ°å„ÅØÁµÇ„Çè„Å£„ÅüÔºü"],
                    flatter: ["Á¨ë„Å£„ÅüÈ°î„ÅåÁ¥†Êïµ„Å†„Å≠ÔºÅ", "Âêõ„Åø„Åü„ÅÑ„Å™Â§©ÊâçÂàù„ÇÅ„Å¶Ë¶ã„Åü„Çà„ÄÇ", "„ÇÑ„Å£„Å±„ÇäÂêõ„ÅØÂÑ™„Åó„ÅÑ„Å≠„ÄÇ", "‰ªäÊó•„ÅÆ„Çπ„Çø„Ç§„É´„ÄÅ„Ç¢„Ç§„Éâ„É´„Åø„Åü„ÅÑÔºÅ"],
                    attack: ["Êú¨ÂΩì„Å´Ëá™ÂàÜÂãùÊâã„Å†„Å≠„ÄÇ", "ËâØÂøÉ„Åå„ÅÇ„Çã„Å™„ÇâË≠≤„Å£„Å¶„Çà„ÄÇ", "Ë©±„ÅåÈÄö„Åò„Å™„ÅÑ„Å™„ÄÇ", "ÂèãÈÅî„ÅÑ„Å™„ÅÑ„Åß„Åó„ÇáÔºü"],
                    cry: ["ÊúÄËøë„Å§„Çâ„ÅÑ„Çì„Å†...", "‰ªäÊó•„Å†„ÅëË≠≤„Å£„Å¶„Åè„Çå„Å™„ÅÑÔºü", "„ÅÜ„ÅÜ... Á≥ñÂàÜ„ÅåÂøÖË¶Å„Å™„ÅÆ...", "ÁßÅ„ÅåÂèØÂìÄÊÉ≥„Åò„ÇÉ„Å™„ÅÑ„ÅÆÔºü"],
                    stun: ["„ÅÜ„ÅÜ... „É°„É≥„Çø„É´Â¥©Â£ä...", "Ë®ÄËëâ„ÅåÂá∫„Å™„ÅÑ...", "„Å≤„Å©„ÅÑ...", "..."]
                },
                alertNoHp: "„É°„É≥„Çø„É´„ÅåË∂≥„Çä„Åæ„Åõ„ÇìÔºÅ ‰ºëÊÜ©ÔºàÈõëË´á/„Åä‰∏ñËæûÔºâ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ"
            }
        };

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentLang = 'ko'; // Í∏∞Î≥∏Í∞í
        let gameState = {
            p1Hp: 100,
            p2Hp: 100,
            cakePos: 50,
            turn: 'player',
            isGameOver: false
        };

        // --- Ïñ∏Ïñ¥ ÏÑ†ÌÉù Ìï®Ïàò ---
        function selectLanguage(lang) {
            currentLang = lang;
            
            // Ìè∞Ìä∏ Î≥ÄÍ≤Ω (ÏùºÎ≥∏Ïñ¥ ÏÑ†ÌÉùÏãú Îë•Í∑º Ìè∞Ìä∏ Ï†ÅÏö©)
            if (lang === 'ja') document.body.classList.add('ja-font');
            else document.body.classList.remove('ja-font');

            applyLanguage();
            
            // ÌôîÎ©¥ Ï†ÑÌôò
            document.getElementById('lang-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
        }

        // ÌÖçÏä§Ìä∏ ÏùºÍ¥Ñ Ï†ÅÏö© Ìï®Ïàò
        function applyLanguage() {
            const data = langData[currentLang];
            
            // ÏãúÏûë ÌôîÎ©¥
            document.getElementById('title-text').innerText = data.title;
            document.getElementById('desc-main').innerText = data.descMain;
            document.getElementById('desc-sub').innerText = data.descSub;
            document.getElementById('start-btn-text').innerText = data.startBtn;
            
            // Í≤åÏûÑ Ïò§Î≤Ñ ÌôîÎ©¥
            document.getElementById('restart-btn-text').innerText = data.restartBtn;

            // UI
            document.getElementById('ui-you').innerText = data.ui.you;
            document.getElementById('ui-rival').innerText = data.ui.rival;
            document.getElementById('ui-heal').innerText = data.ui.heal;

            // Î≤ÑÌäº ÌÖçÏä§Ìä∏
            document.getElementById('btn-chat-name').innerText = data.ui.btns.chat.name;
            document.getElementById('btn-chat-desc').innerText = data.ui.btns.chat.desc;
            document.getElementById('btn-flatter-name').innerText = data.ui.btns.flatter.name;
            document.getElementById('btn-flatter-desc').innerText = data.ui.btns.flatter.desc;
            document.getElementById('btn-attack-name').innerText = data.ui.btns.attack.name;
            document.getElementById('btn-attack-desc').innerText = data.ui.btns.attack.desc;
            document.getElementById('btn-cry-name').innerText = data.ui.btns.cry.name;
            document.getElementById('btn-cry-desc').innerText = data.ui.btns.cry.desc;
        }

        // Ïù¥ÎØ∏ÏßÄ Î°úÎî© Ïò§Î•ò Ï≤òÎ¶¨
        function handleImageError(img, name) {
            if (img.dataset.retried === "true") {
                let color = '808080';
                if(name === 'pc1') color = 'FFB6C1';
                if(name === 'pc2') color = 'ADD8E6';
                if(name === 'cake') color = '8B4513';
                img.src = `https://placehold.co/200x400/${color}/white?text=${name}`;
                return;
            }
            img.dataset.retried = "true";
            img.src = name + ".jpg";
        }

        function loadBackground() {
            const gameScene = document.getElementById('game-scene');
            const bgImg = new Image();
            bgImg.onload = function() {
                gameScene.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('background.png')`;
            };
            bgImg.onerror = function() {
                const bgImgJpg = new Image();
                bgImgJpg.onload = function() {
                      gameScene.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('background.jpg')`;
                };
                bgImgJpg.src = 'background.jpg';
            };
            bgImg.src = 'background.png';
        }
        window.addEventListener('load', loadBackground);

        const elCake = document.getElementById('cake-obj');
        const elP1Hp = document.getElementById('p1-hp');
        const elP2Hp = document.getElementById('p2-hp');
        const elP1HpText = document.getElementById('p1-hp-text');
        const elP2HpText = document.getElementById('p2-hp-text');
        const elControls = document.getElementById('controls');
        const elTurnIndicator = document.getElementById('turn-indicator');
        
        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            if (audioCtx.state === 'suspended') audioCtx.resume();
            updateUI();
            showTurnIndicator(langData[currentLang].turn.player);
        }

        function showTurnIndicator(text) {
            elTurnIndicator.innerText = text;
            elTurnIndicator.style.opacity = 1;
            setTimeout(() => { elTurnIndicator.style.opacity = 0; }, 1000);
        }

        // [Ï§ëÏöî] ÎûúÎç§ Î≥¥Ï†ïÍ∞í Í≥ÑÏÇ∞ Ìï®Ïàò
        function calculateVariance(baseValue) {
            if (baseValue === 0) return 0;
            // -20% ~ +40% Î≤îÏúÑÏùò ÎûúÎç§ Í≥ÑÏàò (0.8 ~ 1.4)
            const factor = 0.8 + (Math.random() * 0.6);
            return {
                value: Math.round(baseValue * factor),
                factor: factor
            };
        }

        function playerAction(type) {
            if (gameState.turn !== 'player' || gameState.isGameOver) return;

            let cost = 0;
            if (type === 'chat') cost = 2;
            else if (type === 'attack') cost = 10;
            else if (type === 'cry') cost = 0;

            if (gameState.p1Hp < cost) {
                alert(langData[currentLang].alertNoHp);
                return;
            }

            executeAction('player', type);
            
            if (!gameState.isGameOver) {
                gameState.turn = 'ai';
                disableControls(true);
                setTimeout(aiTurn, 2000);
            }
        }

        function aiTurn() {
            if (gameState.isGameOver) return;
            showTurnIndicator(langData[currentLang].turn.ai);

            setTimeout(() => {
                if (gameState.p2Hp <= 0) {
                    checkWin();
                    return;
                }

                let actionType = 'chat';
                
                if (gameState.p2Hp <= 20) actionType = 'cry';
                else if (gameState.cakePos <= 30) actionType = 'flatter';
                else if (gameState.p1Hp > 50 && Math.random() > 0.5) actionType = 'attack';
                else {
                    const actions = ['chat', 'flatter', 'attack'];
                    actionType = actions[Math.floor(Math.random() * actions.length)];
                }
                
                executeAction('ai', actionType);

                if (!gameState.isGameOver) {
                    gameState.turn = 'player';
                    disableControls(false);
                    showTurnIndicator(langData[currentLang].turn.player);
                }
            }, 1000);
        }

        function executeAction(actor, type) {
            const isPlayer = actor === 'player';
            const target = isPlayer ? 'ai' : 'player';
            
            playSound(type);

            const currentDialogues = langData[currentLang].dialogues[type];
            const msg = currentDialogues[Math.floor(Math.random() * currentDialogues.length)];
            
            showBubble(isPlayer ? 'pc1' : 'pc2', msg);

            // Í∏∞Î≥∏ ÏàòÏπò ÏÑ§Ï†ï
            let baseCakeMove = 0;
            let baseSelfHpChange = 0;
            let baseEnemyHpChange = 0;

            switch(type) {
                case 'chat': 
                    baseCakeMove = isPlayer ? -12 : 12;
                    baseSelfHpChange = -2; // Cost (Í≥†Ï†ï)
                    break;
                case 'flatter': 
                    baseCakeMove = isPlayer ? -28 : 28;
                    baseEnemyHpChange = +10; // Ï†Å ÌöåÎ≥µ (Î≥ÄÎèô)
                    createEffect(isPlayer ? 'pc2-container' : 'pc1-container', '‚ú®');
                    break;
                case 'attack': 
                    baseCakeMove = isPlayer ? -5 : 5;
                    baseEnemyHpChange = -20; // Ï†Å Îç∞ÎØ∏ÏßÄ (Î≥ÄÎèô)
                    baseSelfHpChange = -10; // Cost (Í≥†Ï†ï)
                    const victim = isPlayer ? document.getElementById('pc2-container') : document.getElementById('pc1-container');
                    victim.classList.add('shake');
                    setTimeout(() => victim.classList.remove('shake'), 500);
                    createEffect(isPlayer ? 'pc2-container' : 'pc1-container', 'üí¢');
                    break;
                case 'cry': 
                    baseCakeMove = isPlayer ? 5 : -5;
                    baseSelfHpChange = +24; // ÏûêÍ∞Ä ÌöåÎ≥µ (Î≥ÄÎèô)
                    createEffect(isPlayer ? 'pc1-container' : 'pc2-container', 'üíß');
                    break;
            }

            // ÎûúÎç§ Î≥ÄÎèô Ï†ÅÏö© (CostÏù∏ -HPÎäî Í≥†Ï†ï, ÌöåÎ≥µ/Îç∞ÎØ∏ÏßÄ/Ïù¥ÎèôÏùÄ Î≥ÄÎèô)
            const moveResult = calculateVariance(baseCakeMove);
            
            // HP Î≥ÄÌôî Í≥ÑÏÇ∞ (ÏùåÏàòÎ©¥ CostÏùº Ïàò ÏûàÏúºÎÇò, ÏÉÅÎåÄÎ∞© Îç∞ÎØ∏ÏßÄÎäî Î≥ÄÎèô Ï†ÅÏö©)
            let finalSelfHp = baseSelfHpChange;
            let selfFactor = 1.0;
            
            if (baseSelfHpChange > 0) { // ÌöåÎ≥µÏù∏ Í≤ΩÏö∞ Î≥ÄÎèô
                const res = calculateVariance(baseSelfHpChange);
                finalSelfHp = res.value;
                selfFactor = res.factor;
            }

            let finalEnemyHp = baseEnemyHpChange;
            let enemyFactor = 1.0;
            if (baseEnemyHpChange !== 0) { // Ï†ÅÏóêÍ≤å Ï£ºÎäî ÏòÅÌñ•(ÌöåÎ≥µ/Îç∞ÎØ∏ÏßÄ)ÏùÄ Î¨¥Ï°∞Í±¥ Î≥ÄÎèô
                const res = calculateVariance(baseEnemyHpChange);
                finalEnemyHp = res.value;
                enemyFactor = res.factor;
            }

            // Í∞í Ï†ÅÏö©
            if (isPlayer) {
                gameState.p1Hp += finalSelfHp;
                gameState.p2Hp += finalEnemyHp;
            } else {
                gameState.p2Hp += finalSelfHp;
                gameState.p1Hp += finalEnemyHp;
            }
            
            gameState.p1Hp = Math.min(100, gameState.p1Hp);
            gameState.p2Hp = Math.min(100, gameState.p2Hp);
            
            gameState.cakePos += moveResult.value;
            gameState.cakePos = Math.max(0, Math.min(100, gameState.cakePos));

            // Îç∞ÎØ∏ÏßÄ/ÌöåÎ≥µ ÌÖçÏä§Ìä∏ ÌëúÏãú (ÌÅ¨Î¶¨Ìã∞Ïª¨ Ïó¨Î∂Ä Ï†ÑÎã¨)
            if (finalEnemyHp !== 0) showDamage(target, finalEnemyHp, enemyFactor);
            if (finalSelfHp !== 0) showDamage(actor, finalSelfHp, selfFactor);

            updateUI();
            checkWin();
        }

        function updateUI() {
            elCake.style.left = `${gameState.cakePos}%`;
            elP1Hp.style.width = `${Math.max(0, gameState.p1Hp)}%`;
            elP2Hp.style.width = `${Math.max(0, gameState.p2Hp)}%`;
            elP1HpText.innerText = Math.max(0, gameState.p1Hp);
            elP2HpText.innerText = Math.max(0, gameState.p2Hp);

            const btns = elControls.children;
            if (gameState.p1Hp < 2) btns[0].disabled = true; else btns[0].disabled = false;
            if (gameState.p1Hp < 10) btns[2].disabled = true; else btns[2].disabled = false;
            btns[3].disabled = false; 
        }

        function disableControls(disabled) {
            const btns = elControls.querySelectorAll('button');
            btns.forEach(btn => btn.disabled = disabled);
        }

        function showBubble(who, text) {
            const bubbleArea = document.getElementById(`${who}-bubble`);
            const bubbleText = document.getElementById(who === 'pc1' ? 'p1-text' : 'p2-text');
            
            if (!bubbleArea || !bubbleText) return;

            bubbleText.innerText = text;
            bubbleArea.classList.remove('active');
            void bubbleArea.offsetWidth;
            bubbleArea.classList.add('active');
            
            const char = document.getElementById(`${who}-container`);
            if(char) {
                char.classList.add('pop');
                setTimeout(() => char.classList.remove('pop'), 200);
            }
            setTimeout(() => { }, 2500);
        }

        // [ÏàòÏ†ï] Ìå©ÌÑ∞(ÎûúÎç§Î∞∞Ïú®)Ïóê Îî∞Îùº ÌÖçÏä§Ìä∏ Ïä§ÌÉÄÏùº Î≥ÄÍ≤Ω
        function showDamage(who, amount, factor = 1.0) {
            const el = document.createElement('div');
            el.className = 'damage-text';
            
            // + Î∂ÄÌò∏ Î∂ôÏù¥Í∏∞
            const text = amount > 0 ? "+" + amount : amount;
            el.innerText = text;

            // Ïä§ÌÉÄÏùº Î∂ÑÍ∏∞
            if (factor >= 1.2) { // ÎåÄÎ∞ï (120% Ïù¥ÏÉÅ)
                el.innerText += " (Crit!)";
                el.classList.add('dmg-crit');
            } else if (factor <= 0.9) { // Ï™ΩÎ∞ï (90% Ïù¥Ìïò)
                el.classList.add('dmg-weak');
            } else {
                // ÌèâÌÉÄ
                el.style.fontSize = '2rem';
            }

            // ÌöåÎ≥µÏù¥Î©¥ Ï¥àÎ°ùÏÉâ Í≥ÑÏó¥Î°ú Î≥ÄÍ≤Ω (ÏÑ†ÌÉùÏÇ¨Ìï≠)
            if (amount > 0) el.style.color = "#2ecc71";

            const container = document.getElementById(who === 'player' ? 'pc1-container' : 'pc2-container');
            if(!container) return;

            const rect = container.getBoundingClientRect();
            el.style.left = (rect.left + rect.width/2) + 'px';
            el.style.top = (rect.top + 50) + 'px';
            
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        function createEffect(targetId, emoji) {
            const el = document.createElement('div');
            el.style.position = 'absolute';
            el.style.fontSize = '4rem';
            el.style.zIndex = '50';
            el.style.animation = 'floatUp 1s forwards';
            el.innerText = emoji;
            
            const target = document.getElementById(targetId);
            if(!target) return;
            const rect = target.getBoundingClientRect();
            el.style.left = (rect.left + rect.width/2 - 20) + 'px';
            el.style.top = (rect.top) + 'px';

            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        function checkWin() {
            let gameOver = false;
            let playerWin = false;

            if (gameState.p1Hp <= 0 || gameState.p2Hp <= 0) {
                gameOver = true;
                if (gameState.p1Hp > gameState.p2Hp) {
                    playerWin = true;
                } else if (gameState.p2Hp > gameState.p1Hp) {
                    playerWin = false;
                } else {
                    playerWin = gameState.cakePos < 50;
                }
            }
            else if (gameState.cakePos <= 0) {
                gameOver = true;
                playerWin = true;
            } else if (gameState.cakePos >= 100) {
                gameOver = true;
                playerWin = false;
            }

            if (gameOver) {
                playSound(playerWin ? 'win' : 'lose');
                finishGame(playerWin);
            }
        }

        function finishGame(playerWin) {
            gameState.isGameOver = true;
            const screen = document.getElementById('game-over-screen');
            const title = document.getElementById('result-title');
            const desc = document.getElementById('result-desc');
            
            const resData = langData[currentLang].result;

            screen.classList.remove('hidden');
            if (playerWin) {
                title.innerText = resData.winTitle;
                title.style.color = "#ff4757";
                desc.innerText = resData.winDesc;
            } else {
                title.innerText = resData.loseTitle;
                title.style.color = "#5352ed";
                desc.innerText = resData.loseDesc;
            }
        }
    </script>
</body>
</html>

```
