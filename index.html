<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cake Debate Battle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nanum Gothic', sans-serif;
            background-color: #333;
            overflow: hidden;
            user-select: none;
        }

        /* ë°°ê²½ ë° ë ˆì´ì•„ì›ƒ */
        .game-scene {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            background-size: cover;
            background-position: center;
            overflow: hidden;
            transition: background-image 0.5s ease;
        }

        .overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.1);
            pointer-events: none;
        }

        .table-surface {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 35%;
            background: linear-gradient(to bottom, rgba(139, 69, 19, 0.8), rgba(101, 67, 33, 1));
            border-top: 5px solid rgba(255,255,255,0.2);
            transform-origin: bottom;
            transform: perspective(1000px) rotateX(20deg) scale(1.2);
            z-index: 1;
        }

        /* ìºë¦­í„° ì»¨í…Œì´ë„ˆ: ë§í’ì„  ìœ„ì¹˜ì˜ ê¸°ì¤€ì ì´ ë©ë‹ˆë‹¤ */
        .character-container {
            position: absolute;
            bottom: 15%;
            width: 35vh;
            height: 60vh;
            z-index: 2;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
            display: flex;
            align-items: flex-end; /* ì´ë¯¸ì§€ëŠ” ë°”ë‹¥ì— ì •ë ¬ */
            justify-content: center;
        }

        .character-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: bottom;
            transform: scaleX(-1); /* ì„œë¡œ ë§ˆì£¼ë³´ê²Œ ë°˜ì „ */
        }

        #pc1-container { left: 5%; }
        #pc2-container { right: 5%; }

        /* ì¼€ì´í¬ */
        .cake-track {
            position: absolute;
            bottom: 25%;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 10px;
            z-index: 3;
            border-radius: 50%;
        }

        .cake-obj {
            position: absolute;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            width: 18vh;
            height: auto;
            transition: left 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.4));
            z-index: 4;
        }

        /* ë§í’ì„  ìœ„ì¹˜ ìˆ˜ì •: ìºë¦­í„° ë¨¸ë¦¬ ìœ„ */
        .bubble-area {
            position: absolute;
            bottom: 90%; /* ìºë¦­í„° ì»¨í…Œì´ë„ˆì˜ ìƒë‹¨(ë¨¸ë¦¬ ë¶€ê·¼)ì— ìœ„ì¹˜ */
            left: 50%;
            width: 300px;
            z-index: 50;
            opacity: 0;
            /* ì¤‘ì•™ ì •ë ¬ ë° ì´ˆê¸° ì¶•ì†Œ ìƒíƒœ */
            transform: translateX(-50%) scale(0.8);
            transform-origin: bottom center; /* ì•„ë˜ìª½ ì¤‘ì‹¬ìœ¼ë¡œ ì»¤ì§€ê²Œ */
            transition: opacity 0.3s ease, transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
            display: flex;
            justify-content: center;
        }

        /* ë§í’ì„  í™œì„±í™” í´ë˜ìŠ¤ */
        .bubble-area.active {
            opacity: 1 !important;
            transform: translateX(-50%) scale(1);
        }

        .bubble {
            background: white;
            padding: 1.2rem;
            border-radius: 20px;
            border: 3px solid #000;
            font-family: 'Jua', sans-serif;
            font-size: 1.2rem;
            line-height: 1.3;
            color: #333;
            box-shadow: 5px 5px 0px rgba(0,0,0,0.2);
            position: relative;
            text-align: center;
            word-break: keep-all;
            background-color: #fff;
        }

        /* ë§í’ì„  ê¼¬ë¦¬ (ì¤‘ì•™ í•˜ë‹¨) */
        .bubble::after {
            content: '';
            position: absolute;
            bottom: -18px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-width: 18px 12px 0;
            border-style: solid;
            border-color: #000 transparent transparent transparent;
        }
        .bubble::before {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-width: 18px 12px 0;
            border-style: solid;
            border-color: #fff transparent transparent transparent;
            z-index: 1;
        }

        /* UI íŒ¨ë„ */
        .ui-panel {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 25%;
            background: linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0));
            z-index: 20;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding-bottom: 2rem;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 5%;
            margin-bottom: 1rem;
        }

        .hp-container {
            width: 300px;
            position: relative;
        }

        .hp-label {
            color: white;
            font-family: 'Jua', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 0 #000;
            display: flex;
            justify-content: space-between;
        }

        .hp-frame {
            height: 25px;
            background: #444;
            border: 3px solid white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .hp-bar {
            height: 100%;
            width: 100%;
            transition: width 0.5s ease;
        }
        #p1-hp { background: linear-gradient(90deg, #ff6b6b, #ff4757); }
        #p2-hp { background: linear-gradient(90deg, #5352ed, #3742fa); }

        .controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .btn-card {
            width: 140px;
            height: 100px;
            background: white;
            border: 4px solid #333;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 6px 0 #888;
            font-family: 'Jua', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .btn-card:active {
            transform: translateY(6px);
            box-shadow: 0 0 0 #888;
        }
        
        .btn-card:disabled {
            filter: grayscale(100%);
            opacity: 0.6;
            cursor: not-allowed;
            transform: translateY(6px);
            box-shadow: 0 0 0 #888;
        }

        .btn-icon { font-size: 2rem; margin-bottom: 5px; }
        .btn-text { font-size: 1.2rem; font-weight: bold; }
        .btn-cost { 
            position: absolute; 
            top: 5px; 
            right: 5px; 
            font-size: 0.8rem; 
            color: #e74c3c; 
            font-weight: bold; 
        }

        .turn-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 1rem 3rem;
            border-radius: 50px;
            font-family: 'Jua', sans-serif;
            font-size: 2rem;
            z-index: 50;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            white-space: nowrap;
            border: 2px solid white;
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .shake { animation: shake 0.5s; }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .pop { animation: pop 0.2s; }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: 'Jua', sans-serif;
        }
        .modal h1 { font-size: 4rem; margin-bottom: 2rem; text-shadow: 4px 4px 0 #ff4757; }
        .start-btn {
            background: #ff4757;
            color: white;
            padding: 1rem 3rem;
            font-size: 2rem;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 6px 0 #c0392b;
            transition: transform 0.1s;
        }
        .start-btn:active { transform: translateY(6px); box-shadow: none; }
        .hidden { display: none !important; }

        .center-line {
            position: absolute;
            left: 50%;
            bottom: 25%;
            height: 100px;
            border-left: 2px dashed rgba(255,255,255,0.5);
            transform: translateX(-50%);
            z-index: 2;
        }

        .damage-text {
            position: absolute;
            color: #ff4757;
            font-weight: bold;
            font-size: 2rem;
            text-shadow: 2px 2px 0 white;
            animation: floatUp 1s forwards;
            pointer-events: none;
            z-index: 50;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(1.2); opacity: 0; }
        }
    </style>
</head>
<body>

    <!-- ì‹œì‘ í™”ë©´ -->
    <div id="start-screen" class="modal">
        <h1>ğŸ° Cake Debate ğŸ°</h1>
        <p class="mb-8 text-xl text-gray-300">ë§ë¡œ ìƒëŒ€ë¥¼ ì œì••í•˜ê³  ì¼€ì´í¬ë¥¼ ì°¨ì§€í•˜ì„¸ìš”!</p>
        <p class="mb-8 text-md text-gray-400">ì‚¬ìš´ë“œê°€ ì¬ìƒë©ë‹ˆë‹¤. ë³¼ë¥¨ì„ ì¡°ì ˆí•´ì£¼ì„¸ìš”.</p>
        <button class="start-btn" onclick="startGame()">í† ë¡  ì‹œì‘</button>
    </div>

    <!-- ê²Œì„ ì˜¤ë²„ í™”ë©´ -->
    <div id="game-over-screen" class="modal hidden">
        <h1 id="result-title">Player Win!</h1>
        <p id="result-desc" class="mb-8 text-xl">ì¼€ì´í¬ëŠ” ì´ì œ ì œ ê²ë‹ˆë‹¤.</p>
        <button class="start-btn" onclick="location.reload()">ë‹¤ì‹œ í•˜ê¸°</button>
    </div>

    <!-- ì¸ê²Œì„ ì”¬ -->
    <div id="game-scene" class="game-scene">
        <div class="overlay"></div>
        <div class="table-surface"></div>
        <div class="center-line"></div>

        <!-- ìºë¦­í„° ë° ë§í’ì„  (ìºë¦­í„° ì»¨í…Œì´ë„ˆ ì•ˆì— ë§í’ì„ ì„ í¬í•¨ì‹œí‚´) -->
        <div id="pc1-container" class="character-container">
            <!-- ë§í’ì„  -->
            <div id="pc1-bubble" class="bubble-area">
                <div class="bubble" id="p1-text">...</div>
            </div>
            <!-- ìºë¦­í„° ì´ë¯¸ì§€ -->
            <img id="img-pc1" src="pc1.png" class="character-img" alt="Player" 
                 onerror="handleImageError(this, 'pc1')">
        </div>

        <div id="pc2-container" class="character-container">
            <!-- ë§í’ì„  -->
            <div id="pc2-bubble" class="bubble-area">
                <div class="bubble" id="p2-text">...</div>
            </div>
            <!-- ìºë¦­í„° ì´ë¯¸ì§€ -->
            <img id="img-pc2" src="pc2.png" class="character-img" alt="Rival" 
                 onerror="handleImageError(this, 'pc2')">
        </div>

        <!-- ì¼€ì´í¬ -->
        <div class="cake-track">
            <div id="cake-obj" class="cake-obj">
                <img id="img-cake" src="cake.png" style="width:100%; border-radius:10px; border:2px solid white; box-shadow:0 4px 8px rgba(0,0,0,0.3);" alt="Cake"
                     onerror="handleImageError(this, 'cake')">
                <div class="absolute -bottom-6 w-full text-center text-white font-bold drop-shadow-md">TARGET</div>
            </div>
        </div>

        <!-- í„´ ì•Œë¦¼ -->
        <div id="turn-indicator" class="turn-indicator">Player Turn</div>

        <!-- UI íŒ¨ë„ -->
        <div class="ui-panel">
            <div class="status-bar">
                <div class="hp-container">
                    <div class="hp-label">
                        <span>YOU</span>
                        <span id="p1-hp-text">100</span>
                    </div>
                    <div class="hp-frame">
                        <div id="p1-hp" class="hp-bar"></div>
                    </div>
                </div>

                <div class="hp-container text-right">
                    <div class="hp-label">
                        <span id="p2-hp-text">100</span>
                        <span>RIVAL</span>
                    </div>
                    <div class="hp-frame">
                        <div id="p2-hp" class="hp-bar"></div>
                    </div>
                </div>
            </div>

            <div class="controls" id="controls">
                <button class="btn-card" onclick="playerAction('chat')">
                    <div class="btn-cost">MP 5</div>
                    <div class="btn-icon">ğŸ’¬</div>
                    <div class="btn-text">ì•„ë¬´ë§</div>
                    <div class="text-xs text-gray-500 mt-1">ë‹¹ê¸°ê¸° (+)</div>
                </button>
                <button class="btn-card" onclick="playerAction('flatter')">
                    <div class="btn-cost">MP 0</div>
                    <div class="btn-icon">âœ¨</div>
                    <div class="btn-text">ì¹­ì°¬</div>
                    <div class="text-xs text-gray-500 mt-1">ì  íšŒë³µ / ê°•í•œ ë‹¹ê¸°ê¸° (*)</div>
                </button>
                <button class="btn-card" onclick="playerAction('attack')">
                    <div class="btn-cost">MP 15</div>
                    <div class="btn-icon">ğŸ’¢</div>
                    <div class="btn-text">ë¹„ë‚œ</div>
                    <div class="text-xs text-gray-500 mt-1">ì  ë©˜íƒˆ ê³µê²© (-)</div>
                </button>
                <button class="btn-card" onclick="playerAction('cry')">
                    <div class="btn-cost">MP 5</div>
                    <div class="btn-icon">ğŸ’§</div>
                    <div class="btn-text">ìŠ¬í””</div>
                    <div class="text-xs text-gray-500 mt-1">íšŒë³µ / ì¼€ì´í¬ ì–‘ë³´ (/)</div>
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- ì‚¬ìš´ë“œ ì‹œìŠ¤í…œ (Web Audio API) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        const sounds = {
            chat: { type: 'sine', freq: [500, 600], duration: 0.1 },
            flatter: { type: 'triangle', freq: [400, 600, 800], duration: 0.15 }, // Arpeggio like
            attack: { type: 'sawtooth', freq: [150, 100], duration: 0.2 },
            cry: { type: 'sine', freq: [400, 300], duration: 0.4 },
            win: { type: 'square', freq: [523, 659, 784, 1046], duration: 0.15 },
            lose: { type: 'sawtooth', freq: [300, 250, 200, 150], duration: 0.3 }
        };

        function playSound(name) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const config = sounds[name];
            if (!config) return;

            let startTime = audioCtx.currentTime;
            
            config.freq.forEach((f, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                
                osc.type = config.type;
                osc.frequency.setValueAtTime(f, startTime + i * 0.1);
                
                gain.gain.setValueAtTime(0.1, startTime + i * 0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + i * 0.1 + config.duration);

                osc.connect(gain);
                gain.connect(audioCtx.destination);
                
                osc.start(startTime + i * 0.1);
                osc.stop(startTime + i * 0.1 + config.duration);
            });
        }

        // ì´ë¯¸ì§€ ë¡œë”© ì˜¤ë¥˜ ì²˜ë¦¬
        function handleImageError(img, name) {
            if (img.dataset.retried === "true") {
                let color = '808080';
                if(name === 'pc1') color = 'FFB6C1';
                if(name === 'pc2') color = 'ADD8E6';
                if(name === 'cake') color = '8B4513';
                img.src = `https://placehold.co/200x400/${color}/white?text=${name}`;
                return;
            }
            img.dataset.retried = "true";
            img.src = name + ".jpg";
        }

        function loadBackground() {
            const gameScene = document.getElementById('game-scene');
            const bgImg = new Image();
            bgImg.onload = function() {
                gameScene.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('background.png')`;
            };
            bgImg.onerror = function() {
                const bgImgJpg = new Image();
                bgImgJpg.onload = function() {
                     gameScene.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('background.jpg')`;
                };
                bgImgJpg.src = 'background.jpg';
            };
            bgImg.src = 'background.png';
        }
        window.addEventListener('load', loadBackground);

        // ê²Œì„ ì„¤ì •
        const MAX_HP = 100;
        let gameState = {
            p1Hp: 100,
            p2Hp: 100,
            cakePos: 50,
            turn: 'player',
            isGameOver: false
        };

        const dialogues = {
            chat: ["ì˜¤ëŠ˜ ë‚ ì”¨ê°€ ì°¸ ì¢‹ì§€ ì•Šì•„?", "ë„ˆ ê·¸ ë¨¸ë¦¬í•€, ì–´ë””ì„œ ìƒ€ì–´?", "ì¼€ì´í¬ì—” ì—­ì‹œ ì•„ë©”ë¦¬ì¹´ë…¸ì§€.", "ê·¼ë° ë„ˆ ìˆ™ì œëŠ” ë‹¤ í–ˆë‹ˆ?"],
            flatter: ["ë„Œ ì›ƒì„ ë•Œê°€ ì œì¼ ì˜ˆë»!", "ë„ˆì²˜ëŸ¼ ë˜‘ë˜‘í•œ ì• ëŠ” ì²˜ìŒ ë´.", "ì—­ì‹œ ë„Œ ë°°ë ¤ì‹¬ì´ ê¹Šêµ¬ë‚˜.", "ì˜¤ëŠ˜ ìŠ¤íƒ€ì¼ ì™„ì „ ì•„ì´ëŒ ê°™ì•„!"],
            attack: ["ë„ˆ ì§„ì§œ ì´ê¸°ì ì´ë‹¤.", "ì–‘ì‹¬ì´ ìˆìœ¼ë©´ ì¢€ ë¹„ì¼œì¤„ë˜?", "ë§ì´ ì•ˆ í†µí•˜ë„¤ ì •ë§.", "ë„ˆ ì¹œêµ¬ ì—†ì§€?"],
            cry: ["ë‚˜ ìš”ì¦˜ ë„ˆë¬´ í˜ë“¤ì–´...", "ì˜¤ëŠ˜ í•˜ë£¨ë§Œ ì–‘ë³´í•´ì£¼ë©´ ì•ˆ ë¼?", "í‘í‘... ë‹¹ ë–¨ì–´ì ¸ì„œ ê·¸ë˜...", "ë‚´ê°€ ë¶ˆìŒí•˜ì§€ë„ ì•Šì•„?"],
            stun: ["ë¨¸ë¦¬ê°€ ë©í•´...", "ë§ë¬¸ì´ ë§‰í˜”ì–´...", "ë„ˆë¬´í•´...", "..."]
        };

        const elCake = document.getElementById('cake-obj');
        const elP1Hp = document.getElementById('p1-hp');
        const elP2Hp = document.getElementById('p2-hp');
        const elP1HpText = document.getElementById('p1-hp-text');
        const elP2HpText = document.getElementById('p2-hp-text');
        const elControls = document.getElementById('controls');
        const elTurnIndicator = document.getElementById('turn-indicator');
        
        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            if (audioCtx.state === 'suspended') audioCtx.resume();
            updateUI();
            showTurnIndicator("ë‹¹ì‹ ì˜ í„´!");
        }

        function showTurnIndicator(text) {
            elTurnIndicator.innerText = text;
            elTurnIndicator.style.opacity = 1;
            setTimeout(() => { elTurnIndicator.style.opacity = 0; }, 1000);
        }

        function playerAction(type) {
            if (gameState.turn !== 'player' || gameState.isGameOver) return;

            let cost = 0;
            if (type === 'chat') cost = 5;
            else if (type === 'attack') cost = 15;
            else if (type === 'cry') cost = 5;

            if (gameState.p1Hp < cost) {
                alert("ë©˜íƒˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤! íœ´ì‹(ì•„ë¬´ë§/ì¹­ì°¬)ì´ í•„ìš”í•©ë‹ˆë‹¤.");
                return;
            }

            executeAction('player', type);
            
            if (!gameState.isGameOver) {
                gameState.turn = 'ai';
                disableControls(true);
                setTimeout(aiTurn, 2000);
            }
        }

        function aiTurn() {
            if (gameState.isGameOver) return;
            showTurnIndicator("ìƒëŒ€ë°©ì˜ í„´...");

            setTimeout(() => {
                let actionType = 'chat';
                
                if (gameState.p2Hp <= 20) actionType = 'cry';
                else if (gameState.cakePos <= 30) actionType = 'flatter';
                else if (gameState.p1Hp > 50 && Math.random() > 0.5) actionType = 'attack';
                else {
                    const actions = ['chat', 'flatter', 'attack'];
                    actionType = actions[Math.floor(Math.random() * actions.length)];
                }

                if (gameState.p2Hp <= 0) {
                    showBubble('pc2', "ìœ¼ìœ¼... (ë©˜íƒˆ ë¶•ê´´)");
                    gameState.p2Hp += 30; // ë³´ë„ˆìŠ¤ íšŒë³µ
                }

                executeAction('ai', actionType);

                if (!gameState.isGameOver) {
                    gameState.turn = 'player';
                    disableControls(false);
                    showTurnIndicator("ë‹¹ì‹ ì˜ í„´!");
                }
            }, 1000);
        }

        function executeAction(actor, type) {
            const isPlayer = actor === 'player';
            const target = isPlayer ? 'ai' : 'player';
            
            // ì‚¬ìš´ë“œ ì¬ìƒ
            playSound(type);

            const msg = dialogues[type][Math.floor(Math.random() * dialogues[type].length)];
            showBubble(isPlayer ? 'pc1' : 'pc2', msg);

            let cakeMove = 0;
            let selfHpChange = 0;
            let enemyHpChange = 0;

            switch(type) {
                case 'chat': 
                    cakeMove = isPlayer ? -10 : 10;
                    selfHpChange = -5;
                    break;
                case 'flatter': 
                    cakeMove = isPlayer ? -20 : 20;
                    enemyHpChange = +15; 
                    createEffect(isPlayer ? 'pc2-container' : 'pc1-container', 'âœ¨');
                    break;
                case 'attack': 
                    cakeMove = 0;
                    enemyHpChange = -25;
                    selfHpChange = -15;
                    const victim = isPlayer ? document.getElementById('pc2-container') : document.getElementById('pc1-container');
                    victim.classList.add('shake');
                    setTimeout(() => victim.classList.remove('shake'), 500);
                    createEffect(isPlayer ? 'pc2-container' : 'pc1-container', 'ğŸ’¢');
                    break;
                case 'cry': 
                    cakeMove = isPlayer ? 5 : -5;
                    selfHpChange = +30;
                    createEffect(isPlayer ? 'pc1-container' : 'pc2-container', 'ğŸ’§');
                    break;
            }

            if (isPlayer) {
                gameState.p1Hp += selfHpChange;
                gameState.p2Hp += enemyHpChange;
            } else {
                gameState.p2Hp += selfHpChange;
                gameState.p1Hp += enemyHpChange;
            }
            
            // HP ìƒí•œ ì œí•œ
            gameState.p1Hp = Math.min(100, gameState.p1Hp);
            gameState.p2Hp = Math.min(100, gameState.p2Hp);
            
            gameState.cakePos += cakeMove;
            gameState.cakePos = Math.max(0, Math.min(100, gameState.cakePos));

            if (enemyHpChange < 0) showDamage(target, enemyHpChange);
            if (selfHpChange < 0) showDamage(actor, selfHpChange);

            updateUI();
            
            // ìŠ¹ë¦¬ ì¡°ê±´ ì²´í¬ (HP 0 ì´í•˜ ì¦‰ì‹œ í™•ì¸)
            checkWin();
        }

        function updateUI() {
            elCake.style.left = `${gameState.cakePos}%`;
            elP1Hp.style.width = `${Math.max(0, gameState.p1Hp)}%`;
            elP2Hp.style.width = `${Math.max(0, gameState.p2Hp)}%`;
            elP1HpText.innerText = Math.max(0, gameState.p1Hp);
            elP2HpText.innerText = Math.max(0, gameState.p2Hp);

            const btns = elControls.children;
            if (gameState.p1Hp < 5) btns[0].disabled = true; else btns[0].disabled = false;
            if (gameState.p1Hp < 15) btns[2].disabled = true; else btns[2].disabled = false;
            if (gameState.p1Hp < 5) btns[3].disabled = true; else btns[3].disabled = false;
        }

        function disableControls(disabled) {
            const btns = elControls.querySelectorAll('button');
            btns.forEach(btn => btn.disabled = disabled);
        }

        function showBubble(who, text) {
            // ë§í’ì„  ID í™•ì¸: pc1 -> pc1-bubble, pc2 -> pc2-bubble
            const bubbleArea = document.getElementById(`${who}-bubble`);
            // í…ìŠ¤íŠ¸ ID í™•ì¸: pc1 -> p1-text, pc2 -> p2-text
            const bubbleText = document.getElementById(who === 'pc1' ? 'p1-text' : 'p2-text');
            
            if (!bubbleArea || !bubbleText) {
                console.error("Bubble element not found:", who);
                return;
            }

            bubbleText.innerText = text;
            
            // ê¸°ì¡´ active í´ë˜ìŠ¤ ì œê±° í›„ ë‹¤ì‹œ ì¶”ê°€í•˜ì—¬ ì• ë‹ˆë©”ì´ì…˜ ë¦¬ì…‹ íš¨ê³¼
            bubbleArea.classList.remove('active');
            void bubbleArea.offsetWidth; // Trigger reflow
            bubbleArea.classList.add('active');
            
            const char = document.getElementById(`${who}-container`);
            if(char) {
                char.classList.add('pop');
                setTimeout(() => char.classList.remove('pop'), 200);
            }

            // í„´ì´ ë°”ë€Œê±°ë‚˜ ì¼ì • ì‹œê°„ í›„ ì‚¬ë¼ì§
            setTimeout(() => {
                // bubbleArea.classList.remove('active'); // ì›í•˜ë©´ ì£¼ì„ í•´ì œí•˜ì—¬ ìë™ ë‹«í˜
            }, 2500);
        }

        function showDamage(who, amount) {
            const el = document.createElement('div');
            el.className = 'damage-text';
            el.innerText = amount;
            const container = document.getElementById(who === 'player' ? 'pc1-container' : 'pc2-container');
            if(!container) return;

            const rect = container.getBoundingClientRect();
            el.style.left = (rect.left + rect.width/2) + 'px';
            el.style.top = (rect.top + 50) + 'px';
            
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        function createEffect(targetId, emoji) {
            const el = document.createElement('div');
            el.style.position = 'absolute';
            el.style.fontSize = '4rem';
            el.style.zIndex = '50';
            el.style.animation = 'floatUp 1s forwards';
            el.innerText = emoji;
            
            const target = document.getElementById(targetId);
            if(!target) return;
            const rect = target.getBoundingClientRect();
            el.style.left = (rect.left + rect.width/2 - 20) + 'px';
            el.style.top = (rect.top) + 'px';

            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        // ìŠ¹ë¦¬ ì²´í¬ (ìˆ˜ì •ëœ ë¡œì§: ë©˜íƒˆ 0 ì´í•˜ or ì¼€ì´í¬ ëê¹Œì§€ ë„ë‹¬)
        function checkWin() {
            let gameOver = false;
            let playerWin = false;

            // 1. ë©˜íƒˆ HP ì²´í¬ (0 ì´í•˜ ë°œìƒ ì‹œ)
            if (gameState.p1Hp <= 0 || gameState.p2Hp <= 0) {
                gameOver = true;
                // ë‘˜ ë‹¤ 0ì´í•˜ë©´ ë” ë†’ì€ ìª½ ìŠ¹ë¦¬ (ë˜ëŠ” ë¬´ìŠ¹ë¶€ ì²˜ë¦¬ ê°€ëŠ¥í•˜ë‚˜ ì—¬ê¸°ì„  Player ìš°ì„ )
                if (gameState.p1Hp > gameState.p2Hp) {
                    playerWin = true;
                } else if (gameState.p2Hp > gameState.p1Hp) {
                    playerWin = false;
                } else {
                    // ë™ì ì¼ ê²½ìš° ì¼€ì´í¬ ìœ„ì¹˜ë¡œ íŒë³„
                    playerWin = gameState.cakePos < 50;
                }
            }
            // 2. ì¼€ì´í¬ ìœ„ì¹˜ ì²´í¬ (ê¸°ì¡´ ë£° ìœ ì§€)
            else if (gameState.cakePos <= 0) {
                gameOver = true;
                playerWin = true;
            } else if (gameState.cakePos >= 100) {
                gameOver = true;
                playerWin = false;
            }

            if (gameOver) {
                playSound(playerWin ? 'win' : 'lose');
                finishGame(playerWin);
            }
        }

        function finishGame(playerWin) {
            gameState.isGameOver = true;
            const screen = document.getElementById('game-over-screen');
            const title = document.getElementById('result-title');
            const desc = document.getElementById('result-desc');

            screen.classList.remove('hidden');
            if (playerWin) {
                title.innerText = "ğŸ‰ YOU WIN! ğŸ‰";
                title.style.color = "#ff4757";
                desc.innerText = "ìƒëŒ€ì˜ ë©˜íƒˆì„ ë¶€ìˆ˜ê³  ì¼€ì´í¬ë¥¼ ìŸì·¨í–ˆìŠµë‹ˆë‹¤!";
            } else {
                title.innerText = "ğŸ˜­ YOU LOSE... ğŸ˜­";
                title.style.color = "#5352ed";
                desc.innerText = "ë©˜íƒˆì´ ë°”ë‹¥ë‚¬ìŠµë‹ˆë‹¤... ì¼€ì´í¬ëŠ” ì € ë©€ë¦¬...";
            }
        }

        updateUI();
    </script>
</body>
</html>
