<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cake Debate Battle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nanum Gothic', sans-serif;
            background-color: #333;
            overflow: hidden;
            user-select: none;
        }

        /* ë°°ê²½ ë° ë ˆì´ì•„ì›ƒ */
        .game-scene {
            position: relative;
            width: 100vw;
            height: 100vh;
            /* ë°°ê²½ ì´ë¯¸ì§€ëŠ” JSë¡œ ë¡œë“œí•©ë‹ˆë‹¤ */
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            background-size: cover;
            background-position: center;
            overflow: hidden;
            transition: background-image 0.5s ease;
        }

        .overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.1);
            pointer-events: none;
        }

        /* í…Œì´ë¸” ëŠë‚Œì„ ìœ„í•œ í•˜ë‹¨ ê·¸ë¼ë°ì´ì…˜ */
        .table-surface {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 35%;
            background: linear-gradient(to bottom, rgba(139, 69, 19, 0.8), rgba(101, 67, 33, 1));
            border-top: 5px solid rgba(255,255,255,0.2);
            transform-origin: bottom;
            transform: perspective(1000px) rotateX(20deg) scale(1.2);
            z-index: 1;
        }

        /* ìºë¦­í„° ì»¨í…Œì´ë„ˆ (ìœ„ì¹˜ ë° ì• ë‹ˆë©”ì´ì…˜ ë‹´ë‹¹) */
        .character-container {
            position: absolute;
            bottom: 15%;
            width: 35vh;
            height: 60vh;
            z-index: 2;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        /* ìºë¦­í„° ì´ë¯¸ì§€ (ë°©í–¥ ë‹´ë‹¹) */
        .character-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: bottom;
            /* ì¤‘ìš”: ë‘ ìºë¦­í„° ëª¨ë‘ ì¤‘ì•™ì„ ë³´ë„ë¡ ì¢Œìš° ë°˜ì „ */
            /* ì›ë³¸ ì´ë¯¸ì§€ê°€ ë°”ê¹¥ìª½ì„ ë³´ê³  ìˆë‹¤ê³  ê°€ì •í•  ë•Œ ì•ˆìª½ì„ ë³´ê²Œ í•¨ */
            transform: scaleX(-1); 
        }

        #pc1-container { left: 5%; }
        /* ìˆ˜ì •ë¨: ì»¨í…Œì´ë„ˆ ë°˜ì „ ì œê±° (ì´ë¯¸ì§€ ìì²´ì—ì„œ ë°˜ì „ ì²˜ë¦¬) */
        #pc2-container { right: 5%; } 

        /* ì¼€ì´í¬ (ì¤„ë‹¤ë¦¬ê¸° ëŒ€ìƒ) */
        .cake-track {
            position: absolute;
            bottom: 25%;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 10px;
            z-index: 3;
            border-radius: 50%;
        }

        .cake-obj {
            position: absolute;
            top: -100px;
            left: 50%; /* JSë¡œ ì œì–´ */
            transform: translateX(-50%);
            width: 18vh;
            height: auto;
            transition: left 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.4));
            z-index: 4;
        }

        /* ë§í’ì„  */
        .bubble-area {
            position: absolute;
            top: 15%;
            width: 300px;
            z-index: 10;
            opacity: 0;
            transition: all 0.4s ease;
            transform: scale(0.8);
        }

        .bubble {
            background: white;
            padding: 1.5rem;
            border-radius: 20px;
            border: 3px solid #000;
            font-family: 'Jua', sans-serif;
            font-size: 1.2rem;
            line-height: 1.4;
            color: #333;
            box-shadow: 8px 8px 0px rgba(0,0,0,0.2);
            position: relative;
        }

        #pc1-bubble { left: 10%; }
        #pc2-bubble { right: 10%; }

        .bubble::after {
            content: '';
            position: absolute;
            bottom: -15px;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 15px solid #000;
        }
        #pc1-bubble .bubble::after { left: 20%; }
        #pc2-bubble .bubble::after { right: 20%; }

        .bubble.active {
            opacity: 1;
            transform: scale(1) translateY(-10px);
        }

        /* UI íŒ¨ë„ (í•˜ë‹¨) */
        .ui-panel {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 25%;
            background: linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0));
            z-index: 20;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding-bottom: 2rem;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 5%;
            margin-bottom: 1rem;
        }

        .hp-container {
            width: 300px;
            position: relative;
        }

        .hp-label {
            color: white;
            font-family: 'Jua', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 0 #000;
            display: flex;
            justify-content: space-between;
        }

        .hp-frame {
            height: 25px;
            background: #444;
            border: 3px solid white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .hp-bar {
            height: 100%;
            width: 100%;
            transition: width 0.5s ease;
        }
        #p1-hp { background: linear-gradient(90deg, #ff6b6b, #ff4757); }
        #p2-hp { background: linear-gradient(90deg, #5352ed, #3742fa); }

        .controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .btn-card {
            width: 140px;
            height: 100px;
            background: white;
            border: 4px solid #333;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 6px 0 #888;
            font-family: 'Jua', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .btn-card:active {
            transform: translateY(6px);
            box-shadow: 0 0 0 #888;
        }
        
        .btn-card:disabled {
            filter: grayscale(100%);
            opacity: 0.6;
            cursor: not-allowed;
            transform: translateY(6px);
            box-shadow: 0 0 0 #888;
        }

        .btn-icon { font-size: 2rem; margin-bottom: 5px; }
        .btn-text { font-size: 1.2rem; font-weight: bold; }
        .btn-cost { 
            position: absolute; 
            top: 5px; 
            right: 5px; 
            font-size: 0.8rem; 
            color: #e74c3c; 
            font-weight: bold; 
        }

        /* í„´ í‘œì‹œê¸° */
        .turn-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 1rem 3rem;
            border-radius: 50px;
            font-family: 'Jua', sans-serif;
            font-size: 2rem;
            z-index: 50;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            white-space: nowrap;
            border: 2px solid white;
        }

        /* ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .shake { animation: shake 0.5s; }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .pop { animation: pop 0.2s; }

        /* ì‹œì‘/ì¢…ë£Œ í™”ë©´ */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: 'Jua', sans-serif;
        }
        .modal h1 { font-size: 4rem; margin-bottom: 2rem; text-shadow: 4px 4px 0 #ff4757; }
        .start-btn {
            background: #ff4757;
            color: white;
            padding: 1rem 3rem;
            font-size: 2rem;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 6px 0 #c0392b;
            transition: transform 0.1s;
        }
        .start-btn:active { transform: translateY(6px); box-shadow: none; }
        
        .hidden { display: none !important; }

        /* ìŠ¹ë¦¬ì„  (ì¤‘ì•™ ì ì„  ë“±) */
        .center-line {
            position: absolute;
            left: 50%;
            bottom: 25%;
            height: 100px;
            border-left: 2px dashed rgba(255,255,255,0.5);
            transform: translateX(-50%);
            z-index: 2;
        }

        .damage-text {
            position: absolute;
            color: #ff4757;
            font-weight: bold;
            font-size: 2rem;
            text-shadow: 2px 2px 0 white;
            animation: floatUp 1s forwards;
            pointer-events: none;
            z-index: 50;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(1.2); opacity: 0; }
        }

    </style>
</head>
<body>

    <!-- ì‹œì‘ í™”ë©´ -->
    <div id="start-screen" class="modal">
        <h1>ğŸ° Cake Debate ğŸ°</h1>
        <p class="mb-8 text-xl text-gray-300">ë§ë¡œ ìƒëŒ€ë¥¼ ì œì••í•˜ê³  ì¼€ì´í¬ë¥¼ ì°¨ì§€í•˜ì„¸ìš”!</p>
        <button class="start-btn" onclick="startGame()">í† ë¡  ì‹œì‘</button>
    </div>

    <!-- ê²Œì„ ì˜¤ë²„ í™”ë©´ -->
    <div id="game-over-screen" class="modal hidden">
        <h1 id="result-title">Player Win!</h1>
        <p id="result-desc" class="mb-8 text-xl">ì¼€ì´í¬ëŠ” ì´ì œ ì œ ê²ë‹ˆë‹¤.</p>
        <button class="start-btn" onclick="location.reload()">ë‹¤ì‹œ í•˜ê¸°</button>
    </div>

    <!-- ì¸ê²Œì„ ì”¬ -->
    <div id="game-scene" class="game-scene">
        <div class="overlay"></div>
        <div class="table-surface"></div>
        <div class="center-line"></div>

        <!-- ìºë¦­í„° -->
        <div id="pc1-container" class="character-container">
            <!-- 1. ë¨¼ì € pc1.png ì‹œë„, ì‹¤íŒ¨í•˜ë©´ pc1.jpg ì‹œë„ -->
            <img id="img-pc1" src="pc1.png" class="character-img" alt="Player" 
                 onerror="handleImageError(this, 'pc1')">
        </div>
        <div id="pc2-container" class="character-container">
            <!-- 1. ë¨¼ì € pc2.png ì‹œë„, ì‹¤íŒ¨í•˜ë©´ pc2.jpg ì‹œë„ -->
            <img id="img-pc2" src="pc2.png" class="character-img" alt="Rival" 
                 onerror="handleImageError(this, 'pc2')">
        </div>

        <!-- ë§í’ì„  -->
        <div id="pc1-bubble" class="bubble-area">
            <div class="bubble" id="p1-text">...</div>
        </div>
        <div id="pc2-bubble" class="bubble-area">
            <div class="bubble" id="p2-text">...</div>
        </div>

        <!-- ì¼€ì´í¬ -->
        <div class="cake-track">
            <div id="cake-obj" class="cake-obj">
                <!-- 1. ë¨¼ì € cake.png ì‹œë„, ì‹¤íŒ¨í•˜ë©´ cake.jpg ì‹œë„ -->
                <img id="img-cake" src="cake.png" style="width:100%; border-radius:10px; border:2px solid white; box-shadow:0 4px 8px rgba(0,0,0,0.3);" alt="Cake"
                     onerror="handleImageError(this, 'cake')">
                <div class="absolute -bottom-6 w-full text-center text-white font-bold drop-shadow-md">TARGET</div>
            </div>
        </div>

        <!-- í„´ ì•Œë¦¼ -->
        <div id="turn-indicator" class="turn-indicator">Player Turn</div>

        <!-- UI íŒ¨ë„ -->
        <div class="ui-panel">
            
            <!-- ìƒíƒœì°½ (HP) -->
            <div class="status-bar">
                <div class="hp-container">
                    <div class="hp-label">
                        <span>YOU</span>
                        <span id="p1-hp-text">100</span>
                    </div>
                    <div class="hp-frame">
                        <div id="p1-hp" class="hp-bar"></div>
                    </div>
                </div>

                <div class="hp-container text-right">
                    <div class="hp-label">
                        <span id="p2-hp-text">100</span>
                        <span>RIVAL</span>
                    </div>
                    <div class="hp-frame">
                        <div id="p2-hp" class="hp-bar"></div>
                    </div>
                </div>
            </div>

            <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
            <div class="controls" id="controls">
                <!-- ë²„íŠ¼ 1: ì•„ë¬´ë§ (Pull) -->
                <button class="btn-card" onclick="playerAction('chat')">
                    <div class="btn-cost">MP 5</div>
                    <div class="btn-icon">ğŸ’¬</div>
                    <div class="btn-text">ì•„ë¬´ë§</div>
                    <div class="text-xs text-gray-500 mt-1">ë‹¹ê¸°ê¸° (+)</div>
                </button>

                <!-- ë²„íŠ¼ 2: ì¹­ì°¬ (Burst) -->
                <button class="btn-card" onclick="playerAction('flatter')">
                    <div class="btn-cost">MP 0</div>
                    <div class="btn-icon">âœ¨</div>
                    <div class="btn-text">ì¹­ì°¬</div>
                    <div class="text-xs text-gray-500 mt-1">ì  íšŒë³µ / ê°•í•œ ë‹¹ê¸°ê¸° (*)</div>
                </button>

                <!-- ë²„íŠ¼ 3: ë¹„ë‚œ (Attack) -->
                <button class="btn-card" onclick="playerAction('attack')">
                    <div class="btn-cost">MP 15</div>
                    <div class="btn-icon">ğŸ’¢</div>
                    <div class="btn-text">ë¹„ë‚œ</div>
                    <div class="text-xs text-gray-500 mt-1">ì  ë©˜íƒˆ ê³µê²© (-)</div>
                </button>

                <!-- ë²„íŠ¼ 4: ìŠ¬í”” (Heal/Yield) -->
                <button class="btn-card" onclick="playerAction('cry')">
                    <div class="btn-cost">MP 5</div>
                    <div class="btn-icon">ğŸ’§</div>
                    <div class="btn-text">ìŠ¬í””</div>
                    <div class="text-xs text-gray-500 mt-1">íšŒë³µ / ì¼€ì´í¬ ì–‘ë³´ (/)</div>
                </button>
            </div>
        </div>
    </div>

    <script>
        // ì´ë¯¸ì§€ ë¡œë”© ì˜¤ë¥˜ ì²˜ë¦¬ê¸° (png ì‹¤íŒ¨ -> jpg ì‹œë„ -> placeholder)
        function handleImageError(img, name) {
            // ì´ë¯¸ ì¬ì‹œë„í–ˆëŠ”ì§€ í™•ì¸ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
            if (img.dataset.retried === "true") {
                // jpgë„ ì‹¤íŒ¨í•˜ë©´ í”Œë ˆì´ìŠ¤í™€ë” í‘œì‹œ
                let color = '808080';
                if(name === 'pc1') color = 'FFB6C1';
                if(name === 'pc2') color = 'ADD8E6';
                if(name === 'cake') color = '8B4513';
                img.src = `https://placehold.co/200x400/${color}/white?text=${name}`;
                return;
            }

            // jpgë¡œ í™•ì¥ì ë³€ê²½í•´ì„œ ì¬ì‹œë„
            img.dataset.retried = "true";
            img.src = name + ".jpg";
            console.log(`Retrying ${name} with .jpg extension...`);
        }

        // ë°°ê²½ ì´ë¯¸ì§€ ë¡œë“œ ì‹œë„
        function loadBackground() {
            const gameScene = document.getElementById('game-scene');
            const bgImg = new Image();
            
            // ë¨¼ì € png ì‹œë„
            bgImg.onload = function() {
                gameScene.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('background.png')`;
            };
            bgImg.onerror = function() {
                // png ì‹¤íŒ¨ ì‹œ jpg ì‹œë„
                const bgImgJpg = new Image();
                bgImgJpg.onload = function() {
                     gameScene.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('background.jpg')`;
                };
                bgImgJpg.src = 'background.jpg';
            };
            bgImg.src = 'background.png';
        }

        // ì´ˆê¸° ì‹¤í–‰
        window.addEventListener('load', loadBackground);


        // ê²Œì„ ì„¤ì •
        const MAX_HP = 100;
        const CAKE_MAX_POS = 100; // 0 = Player, 100 = Rival
        let gameState = {
            p1Hp: 100,
            p2Hp: 100,
            cakePos: 50,
            turn: 'player', // 'player' or 'ai'
            isGameOver: false
        };

        // ëŒ€ì‚¬ ë°ì´í„°ë² ì´ìŠ¤
        const dialogues = {
            chat: [
                "ì˜¤ëŠ˜ ë‚ ì”¨ê°€ ì°¸ ì¢‹ì§€ ì•Šì•„?",
                "ë„ˆ ê·¸ ë¨¸ë¦¬í•€, ì–´ë””ì„œ ìƒ€ì–´?",
                "ì¼€ì´í¬ì—” ì—­ì‹œ ì•„ë©”ë¦¬ì¹´ë…¸ì§€.",
                "ê·¼ë° ë„ˆ ìˆ™ì œëŠ” ë‹¤ í–ˆë‹ˆ?"
            ],
            flatter: [
                "ë„Œ ì›ƒì„ ë•Œê°€ ì œì¼ ì˜ˆë»!",
                "ë„ˆì²˜ëŸ¼ ë˜‘ë˜‘í•œ ì• ëŠ” ì²˜ìŒ ë´.",
                "ì—­ì‹œ ë„Œ ë°°ë ¤ì‹¬ì´ ê¹Šêµ¬ë‚˜.",
                "ì˜¤ëŠ˜ ìŠ¤íƒ€ì¼ ì™„ì „ ì•„ì´ëŒ ê°™ì•„!"
            ],
            attack: [
                "ë„ˆ ì§„ì§œ ì´ê¸°ì ì´ë‹¤.",
                "ì–‘ì‹¬ì´ ìˆìœ¼ë©´ ì¢€ ë¹„ì¼œì¤„ë˜?",
                "ë§ì´ ì•ˆ í†µí•˜ë„¤ ì •ë§.",
                "ë„ˆ ì¹œêµ¬ ì—†ì§€?"
            ],
            cry: [
                "ë‚˜ ìš”ì¦˜ ë„ˆë¬´ í˜ë“¤ì–´...",
                "ì˜¤ëŠ˜ í•˜ë£¨ë§Œ ì–‘ë³´í•´ì£¼ë©´ ì•ˆ ë¼?",
                "í‘í‘... ë‹¹ ë–¨ì–´ì ¸ì„œ ê·¸ë˜...",
                "ë‚´ê°€ ë¶ˆìŒí•˜ì§€ë„ ì•Šì•„?"
            ],
            stun: [
                "ë¨¸ë¦¬ê°€ ë©í•´...",
                "ë§ë¬¸ì´ ë§‰í˜”ì–´...",
                "ë„ˆë¬´í•´...",
                "..."
            ]
        };

        // DOM ìš”ì†Œ
        const elCake = document.getElementById('cake-obj');
        const elP1Hp = document.getElementById('p1-hp');
        const elP2Hp = document.getElementById('p2-hp');
        const elP1HpText = document.getElementById('p1-hp-text');
        const elP2HpText = document.getElementById('p2-hp-text');
        const elControls = document.getElementById('controls');
        const elTurnIndicator = document.getElementById('turn-indicator');
        
        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            updateUI();
            showTurnIndicator("ë‹¹ì‹ ì˜ í„´!");
        }

        // í„´ ì•Œë¦¼ í‘œì‹œ
        function showTurnIndicator(text) {
            elTurnIndicator.innerText = text;
            elTurnIndicator.style.opacity = 1;
            setTimeout(() => {
                elTurnIndicator.style.opacity = 0;
            }, 1000);
        }

        // í”Œë ˆì´ì–´ ì•¡ì…˜
        function playerAction(type) {
            if (gameState.turn !== 'player' || gameState.isGameOver) return;

            // ë¹„ìš© í™•ì¸
            let cost = 0;
            if (type === 'chat') cost = 5;
            else if (type === 'attack') cost = 15;
            else if (type === 'cry') cost = 5;

            if (gameState.p1Hp < cost) {
                alert("ë©˜íƒˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤! íœ´ì‹(ì•„ë¬´ë§/ì¹­ì°¬)ì´ í•„ìš”í•©ë‹ˆë‹¤.");
                return;
            }

            // ì•¡ì…˜ ì‹¤í–‰
            executeAction('player', type);
            
            // í„´ ë„˜ê¸°ê¸°
            if (!gameState.isGameOver) {
                gameState.turn = 'ai';
                disableControls(true);
                setTimeout(aiTurn, 2000);
            }
        }

        // AI í„´ ë¡œì§
        function aiTurn() {
            if (gameState.isGameOver) return;
            showTurnIndicator("ìƒëŒ€ë°©ì˜ í„´...");

            // AI ìƒê° ì‹œê°„ ì—°ì¶œ
            setTimeout(() => {
                // AI ë¡œì§:
                // 1. HPê°€ 20 ì´í•˜ë©´ 'cry' (íšŒë³µ)
                // 2. ì¼€ì´í¬ê°€ 20 ì´í•˜(ëºê¸¸ ìœ„ê¸°)ë©´ 'flatter' (ê°•í•œ ë‹¹ê¸°ê¸°)
                // 3. ìƒëŒ€ HPê°€ ë†’ìœ¼ë©´ 'attack'
                // 4. ê·¸ ì™¸ ëœë¤
                let actionType = 'chat';
                
                if (gameState.p2Hp <= 20) {
                    actionType = 'cry';
                } else if (gameState.cakePos <= 30) {
                    actionType = 'flatter';
                } else if (gameState.p1Hp > 50 && Math.random() > 0.5) {
                    actionType = 'attack';
                } else {
                    const actions = ['chat', 'flatter', 'attack'];
                    actionType = actions[Math.floor(Math.random() * actions.length)];
                }

                // AIê°€ ê¸°ì ˆ ìƒíƒœ(HP 0)ë¼ë©´ í„´ ìŠ¤í‚µ
                if (gameState.p2Hp <= 0) {
                    showBubble('pc2', "ìœ¼ìœ¼... (ë©˜íƒˆ ë¶•ê´´)"); // ID ìˆ˜ì •: p2 -> pc2
                    // ì•½ê°„ì˜ íšŒë³µ
                    gameState.p2Hp += 30;
                    updateUI();
                    setTimeout(() => {
                        gameState.turn = 'player';
                        disableControls(false);
                        showTurnIndicator("ë‹¹ì‹ ì˜ í„´!");
                    }, 1500);
                    return;
                }

                executeAction('ai', actionType);

                if (!gameState.isGameOver) {
                    gameState.turn = 'player';
                    disableControls(false);
                    showTurnIndicator("ë‹¹ì‹ ì˜ í„´!");
                }
            }, 1000);
        }

        // ì•¡ì…˜ ì‹¤í–‰ ê³µí†µ í•¨ìˆ˜
        function executeAction(actor, type) {
            const isPlayer = actor === 'player';
            const target = isPlayer ? 'ai' : 'player';
            
            // 1. ëŒ€ì‚¬ ì¶œë ¥
            const msg = dialogues[type][Math.floor(Math.random() * dialogues[type].length)];
            // ID ìˆ˜ì •: p1 -> pc1, p2 -> pc2
            showBubble(isPlayer ? 'pc1' : 'pc2', msg);

            // 2. íš¨ê³¼ ì ìš©
            let cakeMove = 0;
            let selfHpChange = 0;
            let enemyHpChange = 0;

            switch(type) {
                case 'chat': // ì•„ë¬´ë§: ì†ŒëŸ‰ ë‹¹ê¸°ê¸°, ì†ŒëŸ‰ ì†Œëª¨
                    cakeMove = isPlayer ? -10 : 10;
                    selfHpChange = -5;
                    break;
                case 'flatter': // ì¹­ì°¬: ë§ì´ ë‹¹ê¸°ê¸°, ì  íšŒë³µ
                    cakeMove = isPlayer ? -20 : 20;
                    enemyHpChange = +15; 
                    // ì¹­ì°¬ íš¨ê³¼: ë°˜ì§ì„
                    createEffect(isPlayer ? 'pc2-container' : 'pc1-container', 'âœ¨');
                    break;
                case 'attack': // ë¹„ë‚œ: ì¼€ì´í¬ ì´ë™ ì—†ìŒ, ì  ë°ë¯¸ì§€
                    cakeMove = 0;
                    enemyHpChange = -25;
                    selfHpChange = -15;
                    // ê³µê²© íš¨ê³¼: í”ë“¤ë¦¼
                    const victim = isPlayer ? document.getElementById('pc2-container') : document.getElementById('pc1-container');
                    victim.classList.add('shake');
                    setTimeout(() => victim.classList.remove('shake'), 500);
                    createEffect(isPlayer ? 'pc2-container' : 'pc1-container', 'ğŸ’¢');
                    break;
                case 'cry': // ìŠ¬í””: íšŒë³µ, ì¼€ì´í¬ ì¡°ê¸ˆ ì–‘ë³´
                    cakeMove = isPlayer ? 5 : -5;
                    selfHpChange = +30;
                    createEffect(isPlayer ? 'pc1-container' : 'pc2-container', 'ğŸ’§');
                    break;
            }

            // ìƒíƒœ ì—…ë°ì´íŠ¸
            if (isPlayer) {
                gameState.p1Hp += selfHpChange;
                gameState.p2Hp += enemyHpChange;
            } else {
                gameState.p2Hp += selfHpChange;
                gameState.p1Hp += enemyHpChange;
            }
            
            // HP ë²”ìœ„ ì œí•œ
            gameState.p1Hp = Math.max(0, Math.min(100, gameState.p1Hp));
            gameState.p2Hp = Math.max(0, Math.min(100, gameState.p2Hp));
            
            // ì¼€ì´í¬ ì´ë™
            gameState.cakePos += cakeMove;
            gameState.cakePos = Math.max(0, Math.min(100, gameState.cakePos));

            // ë°ë¯¸ì§€ í…ìŠ¤íŠ¸ í‘œì‹œ
            if (enemyHpChange < 0) showDamage(target, enemyHpChange);
            if (selfHpChange < 0) showDamage(actor, selfHpChange);

            updateUI();
            checkWin();
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            // ì¼€ì´í¬ ìœ„ì¹˜
            elCake.style.left = `${gameState.cakePos}%`;
            
            // HP ë°”
            elP1Hp.style.width = `${gameState.p1Hp}%`;
            elP2Hp.style.width = `${gameState.p2Hp}%`;
            elP1HpText.innerText = gameState.p1Hp;
            elP2HpText.innerText = gameState.p2Hp;

            // ë²„íŠ¼ ìƒíƒœ (MP ë¶€ì¡±ì‹œ ë¹„í™œì„±í™”)
            const btns = elControls.children;
            if (gameState.p1Hp < 5) btns[0].disabled = true; else btns[0].disabled = false; // chat
            // flatter 0 cost always active
            if (gameState.p1Hp < 15) btns[2].disabled = true; else btns[2].disabled = false; // attack
            if (gameState.p1Hp < 5) btns[3].disabled = true; else btns[3].disabled = false; // cry
        }

        function disableControls(disabled) {
            const btns = elControls.querySelectorAll('button');
            btns.forEach(btn => btn.disabled = disabled);
        }

        // ë§í’ì„  í‘œì‹œ
        function showBubble(who, text) {
            const bubbleArea = document.getElementById(`${who}-bubble`);
            // ID ë¡œì§ ìˆ˜ì •: whoê°€ pc1ì´ë©´ p1-text, ì•„ë‹ˆë©´ p2-text
            const bubbleText = document.getElementById(who === 'pc1' ? 'p1-text' : 'p2-text');
            
            bubbleText.innerText = text;
            bubbleArea.classList.add('active');
            
            // ìºë¦­í„° íŒ íš¨ê³¼
            const char = document.getElementById(`${who}-container`);
            char.classList.add('pop');
            setTimeout(() => char.classList.remove('pop'), 200);

            // 3ì´ˆ í›„ ì‚¬ë¼ì§
            setTimeout(() => {
                if(gameState.turn !== (who==='pc1'?'player':'ai')) // í„´ì´ ë°”ë€Œì—ˆìœ¼ë©´ ë” (ID ìˆ˜ì •)
                   bubbleArea.classList.remove('active');
            }, 2500);
        }

        // ë°ë¯¸ì§€ í…ìŠ¤íŠ¸
        function showDamage(who, amount) {
            const el = document.createElement('div');
            el.className = 'damage-text';
            el.innerText = amount;
            const container = document.getElementById(who === 'player' ? 'pc1-container' : 'pc2-container');
            
            // ìœ„ì¹˜ ëœë¤ ì¡°ì •
            const rect = container.getBoundingClientRect();
            el.style.left = (rect.left + rect.width/2) + 'px';
            el.style.top = (rect.top + 50) + 'px';
            
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        // ì´í™íŠ¸ ìƒì„±
        function createEffect(targetId, emoji) {
            const el = document.createElement('div');
            el.style.position = 'absolute';
            el.style.fontSize = '4rem';
            el.style.zIndex = '50';
            el.style.animation = 'floatUp 1s forwards';
            el.innerText = emoji;
            
            const target = document.getElementById(targetId);
            const rect = target.getBoundingClientRect();
            el.style.left = (rect.left + rect.width/2 - 20) + 'px';
            el.style.top = (rect.top) + 'px';

            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        // ìŠ¹ë¦¬ ì²´í¬
        function checkWin() {
            if (gameState.cakePos <= 0) {
                gameOver(true);
            } else if (gameState.cakePos >= 100) {
                gameOver(false);
            }
        }

        function gameOver(playerWin) {
            gameState.isGameOver = true;
            const screen = document.getElementById('game-over-screen');
            const title = document.getElementById('result-title');
            const desc = document.getElementById('result-desc');

            screen.classList.remove('hidden');
            if (playerWin) {
                title.innerText = "ğŸ‰ YOU WIN! ğŸ‰";
                title.style.color = "#ff4757";
                desc.innerText = "ë‹¹ì‹ ì˜ ë§ë¹¨ë¡œ ì¼€ì´í¬ë¥¼ ìŸì·¨í–ˆìŠµë‹ˆë‹¤!";
            } else {
                title.innerText = "ğŸ˜­ YOU LOSE... ğŸ˜­";
                title.style.color = "#5352ed";
                desc.innerText = "ì¼€ì´í¬ë¥¼ ëºê²¼ìŠµë‹ˆë‹¤... ë‹¤ìŒì— ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”.";
            }
        }

        // ì´ˆê¸°í™”
        updateUI();
    </script>
</body>
</html>
